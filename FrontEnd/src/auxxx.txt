
import React, { useState } from "react";
import logo from './logo.svg';
import './Prueba1.css';
//import './Menu.js';
  
async function getUserByID(id) {
  return fetch('http://127.0.0.1:8090/user/' + id, {
    crossDomain:true,
    method: 'GET',
    headers: {
      'Content-Type': 'application/json'
    }
  })
    .then(data => data.json())
 } 
 
 
 async function getUserByLogin(username, password) {
  return fetch('http://127.0.0.1:8090/login', {
    crossDomain:true,
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'},
    body: JSON.stringify({'username': username, 'password': password})
      
  })
  .then(data => data.json())
}
  
function Prueba1() {

  const [userData, setUserData] = useState({});
  const [isUser, setIsUser] = useState(false);
  
  const handleSubmit = async event => {
    //Prevent page reload
    event.preventDefault();

    // Obtenemos Textos
    var {uid, upass}  = document.forms[0];

    // Find user login info
    try{
     // const user = await getUserByID(uid.value);
      const login = await getUserByLogin(uid.value,upass.value);
    } catch(e){
      console.log(e);
    }
  
    setUserData();   // user adentro no va
    setIsUser(true);
    
  };

















import React,{ useState} from "react"
import "./Prueba1.css"
import Cookies from "universal-cookie";
import {CookieUser} from "../cookies/cookieUser"
import swal from "sweetalert2";
const Cookie =new Cookies();

export default function IndexLogin(){
  
    const[user,setUser]= useState("");
    const[password,setPassword] = useState("");
  
    const onChangeUser =  (user)=>{
        setUser(user.target.value);
        
    }
    
    const onChangePas = (password)=>{
    setPassword(password.target.value)};

    
    const requestOptions={
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        
        body: JSON.stringify({user_name : user, password : password })
    };

    const login = async()=>{
        fetch('http://localhost:8090/login',requestOptions)
        .then(response => {if (response.status == 400) {
           swal.fire({
            text: "Datos incorrectos",
            icon: 'error',
           }).then((result) => {
            if (result.isConfirmed) {
                window.location.reload();
                return response.json()
            }})
        }
        if(response.status==201){
          swal.fire({icon: 'success'}
          ).then((result) => {
            if (result.isConfirmed) {
              window.location.replace("/")
              return response.json()
            }})
        }
        return response.json()})
        .then(response => {
            Cookie.set("user", response.id_user + "," + response.token, {path: "/"})
    })
   
    };
   
    const handleSubmit= (event)=>{
        event.preventDefault();
        login();

    };

    return(
      <div className="app2">
        <div className="login-form">
        <form onSubmit={handleSubmit} >
        <ul className="ul">
        
        <h1 className="login">LOGIN</h1>
        
          <li>
        <input id="user" type={"text"} placeholder="user" onChange={onChangeUser} value ={user} required></input>
          </li>
        <li>
        <input id="password" type={"password"} placeholder="password" onChange={onChangePas} value={password} required></input>
        </li>
        <input type="submit" value="Log In"></input>
        </ul>
        
        </form>
        </div>
        </div>

    );




}